#!/usr/bin/env bash
# Fail fast
set -o errexit
set -o nounset
set -o pipefail

# ------------------------------------------------------------
# 1. Install Octave-Forge packages you already wanted
# ------------------------------------------------------------
micromamba run -n notebook octave-cli --eval 'pkg install -forge symbolic control signal'

# ------------------------------------------------------------
# 2. Bring in Plotly-Octave for interactive figures
# ------------------------------------------------------------
echo ">> Cloning Plotly-Octave …"
git clone --depth 1 https://github.com/plotly/plotly_matlab.git "${HOME}/plotly"

echo ">> Caching Plotly JS bundle for offline mode …"
micromamba run -n notebook octave-cli --eval \
  "addpath(genpath('${HOME}/plotly')); \
   getplotlyoffline('https://cdn.plot.ly/plotly-latest.min.js'); \
   savepath"

# ------------------------------------------------------------
# 3. Make sure future Octave sessions see Plotly automatically
# ------------------------------------------------------------
echo "addpath(genpath('${HOME}/plotly'))" >> "${HOME}/.octaverc"

echo "✔ postBuild complete"
